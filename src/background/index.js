var ge=Object.defineProperty;var me=(F,q,X)=>q in F?ge(F,q,{enumerable:!0,configurable:!0,writable:!0,value:X}):F[q]=X;var f=(F,q,X)=>me(F,typeof q!="symbol"?q+"":q,X);(function(){"use strict";var F=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function q(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function X(t){if(t.__esModule)return t;var n=t.default;if(typeof n=="function"){var i=function e(){return this instanceof e?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};i.prototype=n.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(t).forEach(function(e){var b=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(i,e,b.get?b:{enumerable:!0,get:function(){return t[e]}})}),i}var bt={exports:{}};(function(t,n){(function(i,e){t.exports=e()})(F,function(){var i=1e3,e=6e4,b=36e5,m="millisecond",T="second",B="minute",p="hour",U="day",N="week",S="month",W="quarter",I="year",D="date",y="Invalid Date",k=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,J=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,r={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(l){var s=["th","st","nd","rd"],o=l%100;return"["+l+(s[(o-20)%10]||s[o]||s[0])+"]"}},c=function(l,s,o){var u=String(l);return!u||u.length>=s?l:""+Array(s+1-u.length).join(o)+l},v={s:c,z:function(l){var s=-l.utcOffset(),o=Math.abs(s),u=Math.floor(o/60),a=o%60;return(s<=0?"+":"-")+c(u,2,"0")+":"+c(a,2,"0")},m:function l(s,o){if(s.date()<o.date())return-l(o,s);var u=12*(o.year()-s.year())+(o.month()-s.month()),a=s.clone().add(u,S),d=o-a<0,h=s.clone().add(u+(d?-1:1),S);return+(-(u+(o-a)/(d?a-h:h-a))||0)},a:function(l){return l<0?Math.ceil(l)||0:Math.floor(l)},p:function(l){return{M:S,y:I,w:N,d:U,D,h:p,m:B,s:T,ms:m,Q:W}[l]||String(l||"").toLowerCase().replace(/s$/,"")},u:function(l){return l===void 0}},w="en",_={};_[w]=r;var O="$isDayjsObject",H=function(l){return l instanceof z||!(!l||!l[O])},M=function l(s,o,u){var a;if(!s)return w;if(typeof s=="string"){var d=s.toLowerCase();_[d]&&(a=d),o&&(_[d]=o,a=d);var h=s.split("-");if(!a&&h.length>1)return l(h[0])}else{var $=s.name;_[$]=s,a=$}return!u&&a&&(w=a),a||!u&&w},E=function(l,s){if(H(l))return l.clone();var o=typeof s=="object"?s:{};return o.date=l,o.args=arguments,new z(o)},g=v;g.l=M,g.i=H,g.w=function(l,s){return E(l,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var z=function(){function l(o){this.$L=M(o.locale,null,!0),this.parse(o),this.$x=this.$x||o.x||{},this[O]=!0}var s=l.prototype;return s.parse=function(o){this.$d=function(u){var a=u.date,d=u.utc;if(a===null)return new Date(NaN);if(g.u(a))return new Date;if(a instanceof Date)return new Date(a);if(typeof a=="string"&&!/Z$/i.test(a)){var h=a.match(k);if(h){var $=h[2]-1||0,C=(h[7]||"0").substring(0,3);return d?new Date(Date.UTC(h[1],$,h[3]||1,h[4]||0,h[5]||0,h[6]||0,C)):new Date(h[1],$,h[3]||1,h[4]||0,h[5]||0,h[6]||0,C)}}return new Date(a)}(o),this.init()},s.init=function(){var o=this.$d;this.$y=o.getFullYear(),this.$M=o.getMonth(),this.$D=o.getDate(),this.$W=o.getDay(),this.$H=o.getHours(),this.$m=o.getMinutes(),this.$s=o.getSeconds(),this.$ms=o.getMilliseconds()},s.$utils=function(){return g},s.isValid=function(){return this.$d.toString()!==y},s.isSame=function(o,u){var a=E(o);return this.startOf(u)<=a&&a<=this.endOf(u)},s.isAfter=function(o,u){return E(o)<this.startOf(u)},s.isBefore=function(o,u){return this.endOf(u)<E(o)},s.$g=function(o,u,a){return g.u(o)?this[u]:this.set(a,o)},s.unix=function(){return Math.floor(this.valueOf()/1e3)},s.valueOf=function(){return this.$d.getTime()},s.startOf=function(o,u){var a=this,d=!!g.u(u)||u,h=g.p(o),$=function(Q,G){var V=g.w(a.$u?Date.UTC(a.$y,G,Q):new Date(a.$y,G,Q),a);return d?V:V.endOf(U)},C=function(Q,G){return g.w(a.toDate()[Q].apply(a.toDate("s"),(d?[0,0,0,0]:[23,59,59,999]).slice(G)),a)},A=this.$W,x=this.$M,Y=this.$D,et="set"+(this.$u?"UTC":"");switch(h){case I:return d?$(1,0):$(31,11);case S:return d?$(1,x):$(0,x+1);case N:var Z=this.$locale().weekStart||0,ot=(A<Z?A+7:A)-Z;return $(d?Y-ot:Y+(6-ot),x);case U:case D:return C(et+"Hours",0);case p:return C(et+"Minutes",1);case B:return C(et+"Seconds",2);case T:return C(et+"Milliseconds",3);default:return this.clone()}},s.endOf=function(o){return this.startOf(o,!1)},s.$set=function(o,u){var a,d=g.p(o),h="set"+(this.$u?"UTC":""),$=(a={},a[U]=h+"Date",a[D]=h+"Date",a[S]=h+"Month",a[I]=h+"FullYear",a[p]=h+"Hours",a[B]=h+"Minutes",a[T]=h+"Seconds",a[m]=h+"Milliseconds",a)[d],C=d===U?this.$D+(u-this.$W):u;if(d===S||d===I){var A=this.clone().set(D,1);A.$d[$](C),A.init(),this.$d=A.set(D,Math.min(this.$D,A.daysInMonth())).$d}else $&&this.$d[$](C);return this.init(),this},s.set=function(o,u){return this.clone().$set(o,u)},s.get=function(o){return this[g.p(o)]()},s.add=function(o,u){var a,d=this;o=Number(o);var h=g.p(u),$=function(x){var Y=E(d);return g.w(Y.date(Y.date()+Math.round(x*o)),d)};if(h===S)return this.set(S,this.$M+o);if(h===I)return this.set(I,this.$y+o);if(h===U)return $(1);if(h===N)return $(7);var C=(a={},a[B]=e,a[p]=b,a[T]=i,a)[h]||1,A=this.$d.getTime()+o*C;return g.w(A,this)},s.subtract=function(o,u){return this.add(-1*o,u)},s.format=function(o){var u=this,a=this.$locale();if(!this.isValid())return a.invalidDate||y;var d=o||"YYYY-MM-DDTHH:mm:ssZ",h=g.z(this),$=this.$H,C=this.$m,A=this.$M,x=a.weekdays,Y=a.months,et=a.meridiem,Z=function(G,V,it,lt){return G&&(G[V]||G(u,d))||it[V].slice(0,lt)},ot=function(G){return g.s($%12||12,G,"0")},Q=et||function(G,V,it){var lt=G<12?"AM":"PM";return it?lt.toLowerCase():lt};return d.replace(J,function(G,V){return V||function(it){switch(it){case"YY":return String(u.$y).slice(-2);case"YYYY":return g.s(u.$y,4,"0");case"M":return A+1;case"MM":return g.s(A+1,2,"0");case"MMM":return Z(a.monthsShort,A,Y,3);case"MMMM":return Z(Y,A);case"D":return u.$D;case"DD":return g.s(u.$D,2,"0");case"d":return String(u.$W);case"dd":return Z(a.weekdaysMin,u.$W,x,2);case"ddd":return Z(a.weekdaysShort,u.$W,x,3);case"dddd":return x[u.$W];case"H":return String($);case"HH":return g.s($,2,"0");case"h":return ot(1);case"hh":return ot(2);case"a":return Q($,C,!0);case"A":return Q($,C,!1);case"m":return String(C);case"mm":return g.s(C,2,"0");case"s":return String(u.$s);case"ss":return g.s(u.$s,2,"0");case"SSS":return g.s(u.$ms,3,"0");case"Z":return h}return null}(G)||h.replace(":","")})},s.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},s.diff=function(o,u,a){var d,h=this,$=g.p(u),C=E(o),A=(C.utcOffset()-this.utcOffset())*e,x=this-C,Y=function(){return g.m(h,C)};switch($){case I:d=Y()/12;break;case S:d=Y();break;case W:d=Y()/3;break;case N:d=(x-A)/6048e5;break;case U:d=(x-A)/864e5;break;case p:d=x/b;break;case B:d=x/e;break;case T:d=x/i;break;default:d=x}return a?d:g.a(d)},s.daysInMonth=function(){return this.endOf(S).$D},s.$locale=function(){return _[this.$L]},s.locale=function(o,u){if(!o)return this.$L;var a=this.clone(),d=M(o,u,!0);return d&&(a.$L=d),a},s.clone=function(){return g.w(this.$d,this)},s.toDate=function(){return new Date(this.valueOf())},s.toJSON=function(){return this.isValid()?this.toISOString():null},s.toISOString=function(){return this.$d.toISOString()},s.toString=function(){return this.$d.toUTCString()},l}(),ut=z.prototype;return E.prototype=ut,[["$ms",m],["$s",T],["$m",B],["$H",p],["$W",U],["$M",S],["$y",I],["$D",D]].forEach(function(l){ut[l[1]]=function(s){return this.$g(s,l[0],l[1])}}),E.extend=function(l,s){return l.$i||(l(s,z,E),l.$i=!0),E},E.locale=M,E.isDayjs=H,E.unix=function(l){return E(1e3*l)},E.en=_[w],E.Ls=_,E.p={},E})})(bt);var xt=bt.exports;const wt=q(xt),gt="YYYY-MM-DD HH:mm:ss.SSS";function mt(t){console.log(`${wt(new Date).format(gt)} ${t}`)}function ke(t){}function at(t){console.error(`${wt(new Date).format(gt)} ${t}`),console.error(t)}const j="CONTENT_SCRIPT",R="BACKGROUND",ft="OFFSCREEN";for(var L=[],dt=0;dt<256;++dt)L.push((dt+256).toString(16).slice(1));function jt(t,n=0){return(L[t[n+0]]+L[t[n+1]]+L[t[n+2]]+L[t[n+3]]+"-"+L[t[n+4]]+L[t[n+5]]+"-"+L[t[n+6]]+L[t[n+7]]+"-"+L[t[n+8]]+L[t[n+9]]+"-"+L[t[n+10]]+L[t[n+11]]+L[t[n+12]]+L[t[n+13]]+L[t[n+14]]+L[t[n+15]]).toLowerCase()}var st,Pt=new Uint8Array(16);function Nt(){if(!st&&(st=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!st))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return st(Pt)}var Jt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const kt={randomUUID:Jt};function Gt(t,n,i){if(kt.randomUUID&&!n&&!t)return kt.randomUUID();t=t||{};var e=t.random||(t.rng||Nt)();return e[6]=e[6]&15|64,e[8]=e[8]&63|128,jt(e)}var Ft={exports:{}};function Wt(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ht={exports:{}};const Yt=X(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var _t;function zt(){return _t||(_t=1,function(t,n){(function(i,e){t.exports=e()})(F,function(){var i=i||function(e,b){var m;if(typeof window<"u"&&window.crypto&&(m=window.crypto),typeof self<"u"&&self.crypto&&(m=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(m=globalThis.crypto),!m&&typeof window<"u"&&window.msCrypto&&(m=window.msCrypto),!m&&typeof F<"u"&&F.crypto&&(m=F.crypto),!m&&typeof Wt=="function")try{m=Yt}catch{}var T=function(){if(m){if(typeof m.getRandomValues=="function")try{return m.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof m.randomBytes=="function")try{return m.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},B=Object.create||function(){function r(){}return function(c){var v;return r.prototype=c,v=new r,r.prototype=null,v}}(),p={},U=p.lib={},N=U.Base=function(){return{extend:function(r){var c=B(this);return r&&c.mixIn(r),(!c.hasOwnProperty("init")||this.init===c.init)&&(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var r=this.extend();return r.init.apply(r,arguments),r},init:function(){},mixIn:function(r){for(var c in r)r.hasOwnProperty(c)&&(this[c]=r[c]);r.hasOwnProperty("toString")&&(this.toString=r.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),S=U.WordArray=N.extend({init:function(r,c){r=this.words=r||[],c!=b?this.sigBytes=c:this.sigBytes=r.length*4},toString:function(r){return(r||I).stringify(this)},concat:function(r){var c=this.words,v=r.words,w=this.sigBytes,_=r.sigBytes;if(this.clamp(),w%4)for(var O=0;O<_;O++){var H=v[O>>>2]>>>24-O%4*8&255;c[w+O>>>2]|=H<<24-(w+O)%4*8}else for(var M=0;M<_;M+=4)c[w+M>>>2]=v[M>>>2];return this.sigBytes+=_,this},clamp:function(){var r=this.words,c=this.sigBytes;r[c>>>2]&=4294967295<<32-c%4*8,r.length=e.ceil(c/4)},clone:function(){var r=N.clone.call(this);return r.words=this.words.slice(0),r},random:function(r){for(var c=[],v=0;v<r;v+=4)c.push(T());return new S.init(c,r)}}),W=p.enc={},I=W.Hex={stringify:function(r){for(var c=r.words,v=r.sigBytes,w=[],_=0;_<v;_++){var O=c[_>>>2]>>>24-_%4*8&255;w.push((O>>>4).toString(16)),w.push((O&15).toString(16))}return w.join("")},parse:function(r){for(var c=r.length,v=[],w=0;w<c;w+=2)v[w>>>3]|=parseInt(r.substr(w,2),16)<<24-w%8*4;return new S.init(v,c/2)}},D=W.Latin1={stringify:function(r){for(var c=r.words,v=r.sigBytes,w=[],_=0;_<v;_++){var O=c[_>>>2]>>>24-_%4*8&255;w.push(String.fromCharCode(O))}return w.join("")},parse:function(r){for(var c=r.length,v=[],w=0;w<c;w++)v[w>>>2]|=(r.charCodeAt(w)&255)<<24-w%4*8;return new S.init(v,c)}},y=W.Utf8={stringify:function(r){try{return decodeURIComponent(escape(D.stringify(r)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(r){return D.parse(unescape(encodeURIComponent(r)))}},k=U.BufferedBlockAlgorithm=N.extend({reset:function(){this._data=new S.init,this._nDataBytes=0},_append:function(r){typeof r=="string"&&(r=y.parse(r)),this._data.concat(r),this._nDataBytes+=r.sigBytes},_process:function(r){var c,v=this._data,w=v.words,_=v.sigBytes,O=this.blockSize,H=O*4,M=_/H;r?M=e.ceil(M):M=e.max((M|0)-this._minBufferSize,0);var E=M*O,g=e.min(E*4,_);if(E){for(var z=0;z<E;z+=O)this._doProcessBlock(w,z);c=w.splice(0,E),v.sigBytes-=g}return new S.init(c,g)},clone:function(){var r=N.clone.call(this);return r._data=this._data.clone(),r},_minBufferSize:0});U.Hasher=k.extend({cfg:N.extend(),init:function(r){this.cfg=this.cfg.extend(r),this.reset()},reset:function(){k.reset.call(this),this._doReset()},update:function(r){return this._append(r),this._process(),this},finalize:function(r){r&&this._append(r);var c=this._doFinalize();return c},blockSize:16,_createHelper:function(r){return function(c,v){return new r.init(v).finalize(c)}},_createHmacHelper:function(r){return function(c,v){return new J.HMAC.init(r,v).finalize(c)}}});var J=p.algo={};return p}(Math);return i})}(ht)),ht.exports}(function(t,n){(function(i,e){t.exports=e(zt())})(F,function(i){return function(e){var b=i,m=b.lib,T=m.WordArray,B=m.Hasher,p=b.algo,U=[],N=[];(function(){function I(J){for(var r=e.sqrt(J),c=2;c<=r;c++)if(!(J%c))return!1;return!0}function D(J){return(J-(J|0))*4294967296|0}for(var y=2,k=0;k<64;)I(y)&&(k<8&&(U[k]=D(e.pow(y,1/2))),N[k]=D(e.pow(y,1/3)),k++),y++})();var S=[],W=p.SHA256=B.extend({_doReset:function(){this._hash=new T.init(U.slice(0))},_doProcessBlock:function(I,D){for(var y=this._hash.words,k=y[0],J=y[1],r=y[2],c=y[3],v=y[4],w=y[5],_=y[6],O=y[7],H=0;H<64;H++){if(H<16)S[H]=I[D+H]|0;else{var M=S[H-15],E=(M<<25|M>>>7)^(M<<14|M>>>18)^M>>>3,g=S[H-2],z=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;S[H]=E+S[H-7]+z+S[H-16]}var ut=v&w^~v&_,l=k&J^k&r^J&r,s=(k<<30|k>>>2)^(k<<19|k>>>13)^(k<<10|k>>>22),o=(v<<26|v>>>6)^(v<<21|v>>>11)^(v<<7|v>>>25),u=O+o+ut+N[H]+S[H],a=s+l;O=_,_=w,w=v,v=c+u|0,c=r,r=J,J=k,k=u+a|0}y[0]=y[0]+k|0,y[1]=y[1]+J|0,y[2]=y[2]+r|0,y[3]=y[3]+c|0,y[4]=y[4]+v|0,y[5]=y[5]+w|0,y[6]=y[6]+_|0,y[7]=y[7]+O|0},_doFinalize:function(){var I=this._data,D=I.words,y=this._nDataBytes*8,k=I.sigBytes*8;return D[k>>>5]|=128<<24-k%32,D[(k+64>>>9<<4)+14]=e.floor(y/4294967296),D[(k+64>>>9<<4)+15]=y,I.sigBytes=D.length*4,this._process(),this._hash},clone:function(){var I=B.clone.call(this);return I._hash=this._hash.clone(),I}});b.SHA256=B._createHelper(W),b.HmacSHA256=B._createHmacHelper(W)}(Math),i.SHA256})})(Ft);function qt(t){return t.replace(/\_(\w)/g,function(n,i){return i.toUpperCase()})}function St(t,n){let i=Object.assign({},t),e=Object.keys(n);for(let b=0;b<e.length;b++){let m=e[b];i[qt(m)]=n[m]}return i}function Kt(t){let n=new URL(t);return n.origin+n.pathname}function Vt(t){const n={};for(const[i,e]of t)n[i]=e;return n}const Zt="EVENT_BRIDGE",vt=new Map;function P(t,n,{onMessageCallback:i,invokeEnv:e}={invokeEnv:j}){let b=te();return new Promise((T,B)=>{try{Qt(b,{resolve:T,reject:B});let p={action:t,callbackId:b,param:n,from:j,to:R,invokeEnv:e};if(i&&i(p),e==j)""+p.from+p.to+p.action+p.invokeEnv+p.callbackId+p.error,chrome.runtime.sendMessage(p);else if(e==R){p.from=R,p.to=ft,""+p.from+p.to+p.action+p.invokeEnv+p.callbackId+p.error,chrome.runtime.sendMessage(p);try{if(window){const U=new CustomEvent(Zt,{detail:p});window.dispatchEvent(U)}}catch{}}else B(`unknow invokeEnv = ${e}`)}catch(p){at(p),B(p)}})}function Qt(t,n){vt.set(t,n)}function Xt(t){let n=vt.get(t);return vt.delete(t),n}function te(){return Gt()}class $t{constructor(){f(this,"accessToken");f(this,"expiresIn");f(this,"refreshToken");f(this,"refreshTokenExpiresIn");f(this,"scope");f(this,"tokenType")}}const Et={batchAddOrUpdateJobBrowse:async function(t){return await P(this.batchAddOrUpdateJobBrowse.name,t)},batchAddOrUpdateJob:async function(t){return await P(this.batchAddOrUpdateJob.name,t)},addOrUpdateJobBrowse:async function(t){return await P(this.addOrUpdateJobBrowse.name,t)},searchJob:async function(t){return(await P(this.searchJob.name,t)).data},getJobBrowseInfoByIds:async function(t){return(await P(this.getJobBrowseInfoByIds.name,t)).data},statisticJobBrowse:async function(){return(await P(this.statisticJobBrowse.name,{})).data},statisticJobSearchGroupByAvgSalary:async function(t){return(await P(this.statisticJobSearchGroupByAvgSalary.name,t)).data},getJobByDetailUrl:async function(t,{invokeEnv:n}={invokeEnv:j}){return(await P(this.getJobByDetailUrl.name,t,{invokeEnv:n})).data},addJobBrowseDetailHistory:async function(t,{invokeEnv:n}={invokeEnv:j}){return await P(this.addJobBrowseDetailHistory.name,t,{invokeEnv:n})}},ct={getConfigByKey:async function(t,{invokeEnv:n}={invokeEnv:j}){return(await P(this.getConfigByKey.name,t,{invokeEnv:n})).data},getAllConfig:async function({invokeEnv:t}={invokeEnv:j}){return(await P(this.getAllConfig.name,{},{invokeEnv:t})).data},addOrUpdateConfig:async function(t,{invokeEnv:n}={invokeEnv:j}){return await P(this.addOrUpdateConfig.name,t,{invokeEnv:n})}};async function ee(t,n,{invokeEnv:i}={invokeEnv:j}){return(await P("httpFetchGetText",t,{onMessageCallback:b=>{n(()=>{Tt(b.callbackId)})},invokeEnv:i})).data}async function ne(t,n,{invokeEnv:i}={invokeEnv:j}){return(await P("httpFetchJson",t,{onMessageCallback:b=>{n&&n(()=>{Tt(b.callbackId)})},invokeEnv:i})).data}async function Tt(t){await P("httpFetchGetTextAbort",t)}function tt(t,n){t.from=R,t.to=j,""+t.from+t.to+t.action+t.invokeEnv+t.callbackId+t.error;let i=JSON.parse(JSON.stringify(t));i.data=n,t.tabId?chrome.tabs.sendMessage(t.tabId,i):chrome.runtime.sendMessage(i)}function K(t,n){t.from=R,t.to=j,at("3.[background][send]["+t.from+" -> "+t.to+"] message [action="+t.action+",invokeEnv="+t.invokeEnv+",callbackId="+t.callbackId+",error="+t.error+"]"),t.tabId?chrome.tabs.sendMessage(t.tabId,t):chrome.runtime.sendMessage(t)}class It{constructor(){f(this,"key");f(this,"value");f(this,"createDatetime");f(this,"updateDatetime")}}const Ot="Iv23liutsRB7F1OJkVIL",re="762e843b1d346533626fe2e9362834c30ad1408c",oe="https://github.com/apps/job-hunting-github-app/installations/new",ie="https://github.com/login/oauth/authorize",ae="https://github.com/login/oauth/access_token",se="https://api.github.com/user",ce="https://github.com/lastsunday/job-hunting-github-app/blob/main/INSTALL",pt=new Map,Bt="KEY_GITHUB_OAUTH_TOKEN",ue={authOauth2Login:async function(t,n){try{chrome.tabs.create({url:`${ie}?client_id=${Ot}`}),pt.set(t)}catch(i){K(t,"[background] authOauth2Login error : "+i.message)}},authInstallAndLogin:async function(t,n){try{chrome.tabs.create({url:`${oe}`}),pt.set(t)}catch(i){K(t,"[background] authInstallAndLogin error : "+i.message)}},authGetToken:async function(t,n){try{tt(t,await Dt())}catch(i){K(t,"[background] authGetToken error : "+i.message)}},authSetToken:async function(t,n){try{await Ut(n),tt(t,{})}catch(i){K(t,"[background] authSetToken error : "+i.message)}}};function le(){return pt}async function Ut(t){let n=new It;return n.key=Bt,n.value=JSON.stringify(t),ct.addOrUpdateConfig(n,{invokeEnv:R})}async function Dt(){let t=new $t,n=await ct.getConfigByKey(Bt,{invokeEnv:R});if(n){let i=JSON.parse(n.value);if(i)return Object.assign(t,i),t}return null}class Mt{constructor(){f(this,"login");f(this,"id");f(this,"nodeId");f(this,"avatarUrl");f(this,"gravatarId");f(this,"url");f(this,"htmlUrl");f(this,"followersUrl");f(this,"followingUrl");f(this,"gistsUrl");f(this,"starredUrl");f(this,"subscriptionsUrl");f(this,"organizationsUrl");f(this,"reposUrl");f(this,"eventsUrl");f(this,"receivedEventsUrl");f(this,"type");f(this,"siteAdmin");f(this,"name");f(this,"company");f(this,"blog");f(this,"location");f(this,"email");f(this,"hireable");f(this,"bio");f(this,"twitterUsername");f(this,"publicRepos");f(this,"publicGists");f(this,"followers");f(this,"following");f(this,"createdAt");f(this,"updatedAt")}}const Ct="KEY_GITHUB_USER",fe={userGet:async function(t,n){try{tt(t,await de())}catch(i){K(t,"[background] userGet error : "+i.message)}},userSet:async function(t,n){try{await Ht(n),tt(t,{})}catch(i){K(t,"[background] userSet error : "+i.message)}}};async function Ht(t){let n=new It;return n.key=Ct,n.value=JSON.stringify(t),ct.addOrUpdateConfig(n,{invokeEnv:R})}async function de(){let t=new Mt,n=await ct.getConfigByKey(Ct,{invokeEnv:R});if(n){let i=JSON.parse(n.value);if(i)return Object.assign(t,i),t}return null}const he={systemTabCreate:async function(t,n){try{tt(t,await chrome.tabs.create(n))}catch(i){K(t,"[background] userGet error : "+i.message)}}};chrome.runtime.onInstalled.addListener(async()=>{const t=[{id:1,action:{type:chrome.declarativeNetRequest.RuleActionType.MODIFY_HEADERS,requestHeaders:[{header:"Referer",operation:chrome.declarativeNetRequest.HeaderOperation.SET,value:"https://creditbj.jxj.beijing.gov.cn/credit-portal/credit_service/publicity/record/black"}]},condition:{initiatorDomains:[chrome.runtime.id],urlFilter:"|https://creditbj.jxj.beijing.gov.cn/credit-portal/api/publicity/record/BLACK/0",resourceTypes:[chrome.declarativeNetRequest.ResourceType.XMLHTTPREQUEST]}}];await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:t.map(n=>n.id),addRules:t})});const Rt=()=>setInterval(chrome.runtime.getPlatformInfo,2e4);chrome.runtime.onStartup.addListener(Rt),Rt(),chrome.action.onClicked.addListener(()=>{chrome.tabs.create({url:"src/sidepanel/index.html"})});const At=new Map,Lt=new Map;chrome.tabs.onUpdated.addListener(async(t,n,i)=>{let e=i.url;if(e!=null&&e.startsWith(ce)&&!ve(e)){let b=le();pe(e);let m=new URL(e);if(m.searchParams.has("error"))b.keys().forEach(T=>{K(T)}),b.clear();else{let T=m.searchParams.get("code");try{const B=new URLSearchParams({client_id:Ot,client_secret:re,code:T});let p=`${ae}?${B.toString()}`,U=await ee(p,k=>{},{invokeEnv:R}),N=new URLSearchParams(U);const S=Vt(N);let W=St(new $t,S);await Ut(W);let I=await ne({url:se,headers:{Authorization:`Bearer ${W.accessToken}`}},k=>{},{invokeEnv:R}),D=St(new Mt,I);await Ht(D);let y=await Dt();b.keys().forEach(k=>{tt(k,y)}),chrome.tabs.remove(t),b.clear()}catch(B){at(B),b.keys().forEach(p=>{K(p)})}}return}if((n==null?void 0:n.status)=="complete"&&!ye(i.id)&&i.url){let b=Kt(i.url),m=await Et.getJobByDetailUrl(b,{invokeEnv:R});m&&(mt(`save jobBrowseDetailHistory start jobId = ${m.jobId}`),await Et.addJobBrowseDetailHistory(m.jobId,{invokeEnv:R}),mt(`save jobBrowseDetailHistory success jobId = ${m.jobId}`),be(i.id))}});function ve(t){return Lt.has(t)}function pe(t){Lt.set(t,null)}function ye(t){return At.has(t)}function be(t){At.set(t,null)}const nt=new Map;function yt(t,n){let i=Object.keys(n);for(let e=0;e<i.length;e++){let b=i[e];t.set(b,n[b])}}yt(nt,ue),yt(nt,fe),yt(nt,he);let rt;async function we(t){var n,i;await((i=(n=chrome.offscreen).hasDocument)==null?void 0:i.call(n))||(rt?await rt:(rt=chrome.offscreen.createDocument({url:chrome.runtime.getURL(t),reasons:[chrome.offscreen.Reason.WORKERS||chrome.offscreen.Reason.BLOBS],justification:"To run web worker to run sqlite"}),await rt,rt=null),chrome.runtime.onMessage.addListener(async function(e,b,m){if(e){if(e.from==j&&e.to==R){b.tab&&(e.tabId=b.tab.id),""+e.from+e.to+e.action+e.invokeEnv+e.callbackId+e.error;let T=e.action;nt.has(T)?nt.get(T)(e,e.param):(e.from=R,e.to=ft,""+e.from+e.to+e.action+e.invokeEnv+e.callbackId+e.error,chrome.runtime.sendMessage(e))}else if(e.from==ft&&e.to==R){if(""+e.from+e.to+e.action+e.invokeEnv+e.callbackId+e.error,e.invokeEnv==j)e.from=R,e.to=j,""+e.from+e.to+e.action+e.invokeEnv+e.callbackId+e.error,e.tabId?chrome.tabs.sendMessage(e.tabId,e):chrome.runtime.sendMessage(e);else if(e.invokeEnv==R){let T=Xt(e.callbackId);T?e.error?(e.message=e.error,T.reject(e)):T.resolve(e):at(`callbackId = ${e.callbackId} lost callback promiseHook`)}}}}))}we("src/offscreen/offscreen.html")})();

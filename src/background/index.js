(function(){"use strict";var dt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var q={exports:{}};(function(e,s){(function(y,n){e.exports=n()})(dt,function(){var y=1e3,n=6e4,w=36e5,j="millisecond",k="second",E="minute",d="hour",M="day",N="week",S="month",at="quarter",B="year",J="date",st="Invalid Date",Et=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Ot=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,gt={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(a){var o=["th","st","nd","rd"],t=a%100;return"["+a+(o[(t-20)%10]||o[t]||o[0])+"]"}},z=function(a,o,t){var i=String(a);return!i||i.length>=o?a:""+Array(o+1-i.length).join(t)+a},Bt={s:z,z:function(a){var o=-a.utcOffset(),t=Math.abs(o),i=Math.floor(t/60),r=t%60;return(o<=0?"+":"-")+z(i,2,"0")+":"+z(r,2,"0")},m:function a(o,t){if(o.date()<t.date())return-a(t,o);var i=12*(t.year()-o.year())+(t.month()-o.month()),r=o.clone().add(i,S),u=t-r<0,c=o.clone().add(i+(u?-1:1),S);return+(-(i+(t-r)/(u?r-c:c-r))||0)},a:function(a){return a<0?Math.ceil(a)||0:Math.floor(a)},p:function(a){return{M:S,y:B,w:N,d:M,D:J,h:d,m:E,s:k,ms:j,Q:at}[a]||String(a||"").toLowerCase().replace(/s$/,"")},u:function(a){return a===void 0}},L="en",T={};T[L]=gt;var ut="$isDayjsObject",K=function(a){return a instanceof P||!(!a||!a[ut])},F=function a(o,t,i){var r;if(!o)return L;if(typeof o=="string"){var u=o.toLowerCase();T[u]&&(r=u),t&&(T[u]=t,r=u);var c=o.split("-");if(!r&&c.length>1)return a(c[0])}else{var f=o.name;T[f]=o,r=f}return!i&&r&&(L=r),r||!i&&L},v=function(a,o){if(K(a))return a.clone();var t=typeof o=="object"?o:{};return t.date=a,t.args=arguments,new P(t)},l=Bt;l.l=F,l.i=K,l.w=function(a,o){return v(a,{locale:o.$L,utc:o.$u,x:o.$x,$offset:o.$offset})};var P=function(){function a(t){this.$L=F(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[ut]=!0}var o=a.prototype;return o.parse=function(t){this.$d=function(i){var r=i.date,u=i.utc;if(r===null)return new Date(NaN);if(l.u(r))return new Date;if(r instanceof Date)return new Date(r);if(typeof r=="string"&&!/Z$/i.test(r)){var c=r.match(Et);if(c){var f=c[2]-1||0,h=(c[7]||"0").substring(0,3);return u?new Date(Date.UTC(c[1],f,c[3]||1,c[4]||0,c[5]||0,c[6]||0,h)):new Date(c[1],f,c[3]||1,c[4]||0,c[5]||0,c[6]||0,h)}}return new Date(r)}(t),this.init()},o.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},o.$utils=function(){return l},o.isValid=function(){return this.$d.toString()!==st},o.isSame=function(t,i){var r=v(t);return this.startOf(i)<=r&&r<=this.endOf(i)},o.isAfter=function(t,i){return v(t)<this.startOf(i)},o.isBefore=function(t,i){return this.endOf(i)<v(t)},o.$g=function(t,i,r){return l.u(t)?this[i]:this.set(r,t)},o.unix=function(){return Math.floor(this.valueOf()/1e3)},o.valueOf=function(){return this.$d.getTime()},o.startOf=function(t,i){var r=this,u=!!l.u(i)||i,c=l.p(t),f=function(H,p){var U=l.w(r.$u?Date.UTC(r.$y,p,H):new Date(r.$y,p,H),r);return u?U:U.endOf(M)},h=function(H,p){return l.w(r.toDate()[H].apply(r.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(p)),r)},$=this.$W,m=this.$M,D=this.$D,C="set"+(this.$u?"UTC":"");switch(c){case B:return u?f(1,0):f(31,11);case S:return u?f(1,m):f(0,m+1);case N:var _=this.$locale().weekStart||0,A=($<_?$+7:$)-_;return f(u?D-A:D+(6-A),m);case M:case J:return h(C+"Hours",0);case d:return h(C+"Minutes",1);case E:return h(C+"Seconds",2);case k:return h(C+"Milliseconds",3);default:return this.clone()}},o.endOf=function(t){return this.startOf(t,!1)},o.$set=function(t,i){var r,u=l.p(t),c="set"+(this.$u?"UTC":""),f=(r={},r[M]=c+"Date",r[J]=c+"Date",r[S]=c+"Month",r[B]=c+"FullYear",r[d]=c+"Hours",r[E]=c+"Minutes",r[k]=c+"Seconds",r[j]=c+"Milliseconds",r)[u],h=u===M?this.$D+(i-this.$W):i;if(u===S||u===B){var $=this.clone().set(J,1);$.$d[f](h),$.init(),this.$d=$.set(J,Math.min(this.$D,$.daysInMonth())).$d}else f&&this.$d[f](h);return this.init(),this},o.set=function(t,i){return this.clone().$set(t,i)},o.get=function(t){return this[l.p(t)]()},o.add=function(t,i){var r,u=this;t=Number(t);var c=l.p(i),f=function(m){var D=v(u);return l.w(D.date(D.date()+Math.round(m*t)),u)};if(c===S)return this.set(S,this.$M+t);if(c===B)return this.set(B,this.$y+t);if(c===M)return f(1);if(c===N)return f(7);var h=(r={},r[E]=n,r[d]=w,r[k]=y,r)[c]||1,$=this.$d.getTime()+t*h;return l.w($,this)},o.subtract=function(t,i){return this.add(-1*t,i)},o.format=function(t){var i=this,r=this.$locale();if(!this.isValid())return r.invalidDate||st;var u=t||"YYYY-MM-DDTHH:mm:ssZ",c=l.z(this),f=this.$H,h=this.$m,$=this.$M,m=r.weekdays,D=r.months,C=r.meridiem,_=function(p,U,x,W){return p&&(p[U]||p(i,u))||x[U].slice(0,W)},A=function(p){return l.s(f%12||12,p,"0")},H=C||function(p,U,x){var W=p<12?"AM":"PM";return x?W.toLowerCase():W};return u.replace(Ot,function(p,U){return U||function(x){switch(x){case"YY":return String(i.$y).slice(-2);case"YYYY":return l.s(i.$y,4,"0");case"M":return $+1;case"MM":return l.s($+1,2,"0");case"MMM":return _(r.monthsShort,$,D,3);case"MMMM":return _(D,$);case"D":return i.$D;case"DD":return l.s(i.$D,2,"0");case"d":return String(i.$W);case"dd":return _(r.weekdaysMin,i.$W,m,2);case"ddd":return _(r.weekdaysShort,i.$W,m,3);case"dddd":return m[i.$W];case"H":return String(f);case"HH":return l.s(f,2,"0");case"h":return A(1);case"hh":return A(2);case"a":return H(f,h,!0);case"A":return H(f,h,!1);case"m":return String(h);case"mm":return l.s(h,2,"0");case"s":return String(i.$s);case"ss":return l.s(i.$s,2,"0");case"SSS":return l.s(i.$ms,3,"0");case"Z":return c}return null}(p)||c.replace(":","")})},o.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},o.diff=function(t,i,r){var u,c=this,f=l.p(i),h=v(t),$=(h.utcOffset()-this.utcOffset())*n,m=this-h,D=function(){return l.m(c,h)};switch(f){case B:u=D()/12;break;case S:u=D();break;case at:u=D()/3;break;case N:u=(m-$)/6048e5;break;case M:u=(m-$)/864e5;break;case d:u=m/w;break;case E:u=m/n;break;case k:u=m/y;break;default:u=m}return r?u:l.a(u)},o.daysInMonth=function(){return this.endOf(S).$D},o.$locale=function(){return T[this.$L]},o.locale=function(t,i){if(!t)return this.$L;var r=this.clone(),u=F(t,i,!0);return u&&(r.$L=u),r},o.clone=function(){return l.w(this.$d,this)},o.toDate=function(){return new Date(this.valueOf())},o.toJSON=function(){return this.isValid()?this.toISOString():null},o.toISOString=function(){return this.$d.toISOString()},o.toString=function(){return this.$d.toUTCString()},a}(),ct=P.prototype;return v.prototype=ct,[["$ms",j],["$s",k],["$m",E],["$H",d],["$W",M],["$M",S],["$y",B],["$D",J]].forEach(function(a){ct[a[1]]=function(o){return this.$g(o,a[0],a[1])}}),v.extend=function(a,o){return a.$i||(a(o,P,v),a.$i=!0),v},v.locale=F,v.isDayjs=K,v.unix=function(a){return v(1e3*a)},v.en=T[L],v.Ls=T,v.p={},v})})(q);var ft=q.exports;const Q=lt(ft),X="YYYY-MM-DD HH:mm:ss.SSS";function tt(e){console.log(`${Q(new Date).format(X)} ${e}`)}function Ut(e){}function et(e){console.error(`${Q(new Date).format(X)} ${e}`),console.error(e)}const O="CONTENT_SCRIPT",I="BACKGROUND",V="OFFSCREEN";function ht(e){let s=new URL(e);return s.origin+s.pathname}for(var b=[],G=0;G<256;++G)b.push((G+256).toString(16).slice(1));function vt(e,s=0){return(b[e[s+0]]+b[e[s+1]]+b[e[s+2]]+b[e[s+3]]+"-"+b[e[s+4]]+b[e[s+5]]+"-"+b[e[s+6]]+b[e[s+7]]+"-"+b[e[s+8]]+b[e[s+9]]+"-"+b[e[s+10]]+b[e[s+11]]+b[e[s+12]]+b[e[s+13]]+b[e[s+14]]+b[e[s+15]]).toLowerCase()}var Y,$t=new Uint8Array(16);function bt(){if(!Y&&(Y=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Y))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Y($t)}var yt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const nt={randomUUID:yt};function mt(e,s,y){if(nt.randomUUID&&!s&&!e)return nt.randomUUID();e=e||{};var n=e.random||(e.rng||bt)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,vt(n)}const pt="EVENT_BRIDGE",Z=new Map;function g(e,s,{onMessageCallback:y,invokeEnv:n}={invokeEnv:O}){let w=Dt();return new Promise((k,E)=>{try{wt(w,{resolve:k,reject:E});let d={action:e,callbackId:w,param:s,from:O,to:I,invokeEnv:n};if(y&&y(d),n==O)""+d.from+d.to+d.action+d.invokeEnv+d.callbackId+d.error,chrome.runtime.sendMessage(d);else if(n==I){d.from=I,d.to=V,""+d.from+d.to+d.action+d.invokeEnv+d.callbackId+d.error,chrome.runtime.sendMessage(d);try{if(window){const M=new CustomEvent(pt,{detail:d});window.dispatchEvent(M)}}catch{}}else E(`unknow invokeEnv = ${n}`)}catch(d){et(d),E(d)}})}function wt(e,s){Z.set(e,s)}function kt(e){let s=Z.get(e);return Z.delete(e),s}function Dt(){return mt()}const rt={batchAddOrUpdateJobBrowse:async function(e){return await g(this.batchAddOrUpdateJobBrowse.name,e)},addOrUpdateJobBrowse:async function(e){return await g(this.addOrUpdateJobBrowse.name,e)},searchJob:async function(e){return(await g(this.searchJob.name,e)).data},getJobBrowseInfoByIds:async function(e){return(await g(this.getJobBrowseInfoByIds.name,e)).data},statisticJobBrowse:async function(){return(await g(this.statisticJobBrowse.name,{})).data},statisticJobSearchGroupByAvgSalary:async function(e){return(await g(this.statisticJobSearchGroupByAvgSalary.name,e)).data},getJobByDetailUrl:async function(e,{invokeEnv:s}={invokeEnv:O}){return(await g(this.getJobByDetailUrl.name,e,{invokeEnv:s})).data},addJobBrowseDetailHistory:async function(e,{invokeEnv:s}={invokeEnv:O}){return await g(this.addJobBrowseDetailHistory.name,e,{invokeEnv:s})}},ot=()=>setInterval(chrome.runtime.getPlatformInfo,2e4);chrome.runtime.onStartup.addListener(ot),ot(),chrome.action.onClicked.addListener(()=>{chrome.tabs.create({url:"src/sidepanel/index.html"})});const it=new Map;chrome.tabs.onUpdated.addListener(async(e,s,y)=>{if((s==null?void 0:s.status)=="complete"&&!Mt(y.id)&&y.url){let n=ht(y.url),w=await rt.getJobByDetailUrl(n,{invokeEnv:I});w&&(tt(`save jobBrowseDetailHistory start jobId = ${w.jobId}`),await rt.addJobBrowseDetailHistory(w.jobId,{invokeEnv:I}),tt(`save jobBrowseDetailHistory success jobId = ${w.jobId}`),St(y.id))}});function Mt(e){return it.has(e)}function St(e){it.set(e,null)}let R;async function It(e){var s,y;await((y=(s=chrome.offscreen).hasDocument)==null?void 0:y.call(s))||(R?await R:(R=chrome.offscreen.createDocument({url:chrome.runtime.getURL(e),reasons:[chrome.offscreen.Reason.WORKERS||chrome.offscreen.Reason.BLOBS],justification:"To run web worker to run sqlite"}),await R,R=null),chrome.runtime.onMessage.addListener(async function(n,w,j){if(n){if(n.from==O&&n.to==I)w.tab&&(n.tabId=w.tab.id),""+n.from+n.to+n.action+n.invokeEnv+n.callbackId+n.error,n.from=I,n.to=V,""+n.from+n.to+n.action+n.invokeEnv+n.callbackId+n.error,chrome.runtime.sendMessage(n);else if(n.from==V&&n.to==I){if(""+n.from+n.to+n.action+n.invokeEnv+n.callbackId+n.error,n.invokeEnv==O)n.from=I,n.to=O,""+n.from+n.to+n.action+n.invokeEnv+n.callbackId+n.error,n.tabId?chrome.tabs.sendMessage(n.tabId,n):chrome.runtime.sendMessage(n);else if(n.invokeEnv==I){let k=kt(n.callbackId);k?n.error?(n.message=n.error,k.reject(n)):k.resolve(n):et(`callbackId = ${n.callbackId} lost callback promiseHook`)}}}}))}It("src/offscreen/offscreen.html")})();
